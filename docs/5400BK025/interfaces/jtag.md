---
id: mk025-jtag
title: JTAG
sidebar_label: JTAG
sidebar_position: 3
---

Микроконтроллер содержит модуль JTAG, который поддерживает обязательные и ряд дополнительных пользовательских инструкции.

## Инструкции

| Инструкция      | Код инструкции | Разрядность регистра данных |
| --------------- | -------------- | --------------------------- |
| EXTEST          | 000b           | –                           |
| TEST_MODE       | 001b           | –                           |
| SAMPLE/PRELOAD  | 010b           | –                           |
| JTAG_RAM_ACCESS | 011b           | 25                          |
| JTAG_ROM_ACCESS | 100b           | 25                          |
| IF_ACCESS       | 101b           | 19                          |
| DEBUGGER        | 110b           | 5                           |
| BYPASS          | 111b           | 1                           |

## Структурная схема

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/jtag/Структурная_схема_JTAG.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Структурная схема модуля JTAG с подключенными к нему блоками</figcaption>
</figure>
</div>

На представленном выше рисунке изображены следующие блоки:

- TAP – управляющий рабочий автомат JTAG;
- TDR_IF_ACCESS – блок управления тестовым пользовательским регистром данных инструкции «IF_ACCESS»;
- TDR_JTAG_MASTER – блок управления тестовым пользовательским регистром данных инструкций «JTAG_RAM_ACCESS» и «JTAG_ROM_ACCESS»;
- TDR_DEBUGGER – блок управления тестовым пользовательским регистром данных инструкции «DEBUGGER»;
- CPU_8051 – процессорное ядро;
- SWITCH_CPU/JTAG – блок, дающий доступ к системной шине CPU или JTAG;
- DEBUGGER – отладчик.

## Инструкции

### TEST_MODE, EXTEST, BYPASS, SAMPLE/PRELOAD

Инструкции «EXTEST» и «SAMPLE/PRELOAD» декодируются TAP-контроллером, но не имеют регистровых цепочек.

Инструкция «TEST_MODE» имеет трехбитовый код 001b и не предполагает использование пользователем.

Инструкция «BYPASS» имеет трехбитовый код 111b и функционирует в соответствии со стандартом IEEE Std 1149.1-2001.

### JTAG_RAM_ACCESS

Инструкция «JTAG_RAM_ACCESS» представляет собой дополнительную пользовательскую инструкцию c кодом 011b, в результате выбора которой CPU 8051 будет отключен от системной шины, а в место него будет подключен тестовый пользовательский регистр данных разрядностью 25 бит:

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th  colSpan={7}> – </th>
    <th >24</th>
  </tr>
     <tr>
    <th >Назначение</th>
    <td  colSpan={7}>–</td>
    <td >SYNCHR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={7}>–</td>
    <td >0</td>
  </tr>
  <tr>
    <th >Бит</th>
    <th >23</th>
    <th >22</th>
    <th >21</th>
    <th >20</th>
    <th >19</th>
    <th >18</th>
    <th >17</th>
    <th >16</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td >RW</td>
    <td >CE_RAM</td>
    <td  colSpan={6}>ADDR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >15</th>
    <th >14</th>
    <th >13</th>
    <th >12</th>
    <th >11</th>
    <th >10</th>
    <th >9</th>
    <th >8</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>ADDR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>DATA</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
</tbody>
</table>

**SYNCHR** – бит синхронизации данных (данные будут переданы, когда будет совершен переход
из «0» в «1»):

- 1 – передать данные в системную шину;
- 0 – подготовка данных для передачи в системную шину.

**RW** – операция чтения или записи:

- 1 – прочитать данные;
- 0 – записать данные.

**CE_RAM** – обращение в область памяти RAM:

- 1 – обращение в RAM-память или к ведомым устройствам системы;
- 0 – область RAM не задействуется.

**ADDR** – адрес обращения.

**DATA** – данные для записи. Младший бит данных находится в бите 7.

При чтении пользовательского тестового регистра данных, считанные с системной шины данные будут переданы со следующим за командой чтения пакетом данных в формате, представленном ниже:

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th  colSpan={7}> – </th>
    <th >24</th>
  </tr>
     <tr>
    <th >Назначение</th>
    <td  colSpan={7}>–</td>
    <td >Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={7}>–</td>
    <td >x</td>
  </tr>
  <tr>
    <th >Бит</th>
    <th >23</th>
    <th >22</th>
    <th >21</th>
    <th >20</th>
    <th >19</th>
    <th >18</th>
    <th >17</th>
    <th >16</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>х</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >15</th>
    <th >14</th>
    <th >13</th>
    <th >12</th>
    <th >11</th>
    <th >10</th>
    <th >9</th>
    <th >8</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>х</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>DATA</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
</tbody>
</table>

<p>При этом во время чтения должна отправляться команда с CE_RAM равным «0». Передача прочитанных данных осуществляется в соответствии со стандартом IEEE Std 1149.1-2001.</p>

:::info Примечание
Выход из инструкции не обнуляет пользовательский тестовый регистр данных.
:::

### JTAG_ROM_ACCESS

Инструкция «JTAG_ROM_ACCESS» представляет собой дополнительную пользовательскую инструкцию c кодом 100b, в результате выбора которой CPU 8051 будет отключен от системной шины, а в место него будет подключен тестовый пользовательский регистр данных разрядностью 24 бит:

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th  colSpan={7}> – </th>
    <th >24</th>
  </tr>
     <tr>
    <th >Назначение</th>
    <td  colSpan={7}>–</td>
    <td >SYNCHR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={7}>–</td>
    <td  > x </td>
  </tr>
  <tr>
    <th >Бит</th>
    <th >23</th>
    <th >22</th>
    <th >21</th>
    <th >20</th>
    <th >19</th>
    <th >18</th>
    <th >17</th>
    <th >16</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td >RW</td>
    <td >CE_ROM</td>
    <td  colSpan={6}>ADDR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >15</th>
    <th >14</th>
    <th >13</th>
    <th >12</th>
    <th >11</th>
    <th >10</th>
    <th >9</th>
    <th >8</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>ADDR</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>DATA</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
</tbody>
</table>

**SYNCHR** – бит синхронизации данных (данные будут переданы, когда будет совершен переход
из «0» в «1»):

- 1 – передать данные в системную шину;
- 0 – подготовка данных для передачи в системную шину.

**RW** – операция чтения или записи;

- 1 – прочитать данные;
- 0 – записать данные.

**CE_ROM** – обращение в область памяти ROM:

- 1 – обращение в ROM-память;
- 0 – область ROM не задействуется.

**ADDR** – адрес обращения.

**DATA** – данные для записи.

При чтении пользовательского тестового регистра данных, считанные с системной шины данные будут переданы со следующим за командой чтения пакетом данных в формате, представленном ниже:

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th  colSpan={7}>–</th>
    <th >24</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={7}>–</td>
    <td  >Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={7}>–</td>
    <td  >х</td>
  </tr>

  <tr>
    <th >Бит</th>
    <th >23</th>
    <th >22</th>
    <th >21</th>
    <th >20</th>
    <th >19</th>
    <th >18</th>
    <th >17</th>
    <th >16</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >15</th>
    <th >14</th>
    <th >13</th>
    <th >12</th>
    <th >11</th>
    <th >10</th>
    <th >9</th>
    <th >8</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>Резерв</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
    <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8}>DATA</td>
  </tr>
  <tr>
    <th >Начальное значение</th>
    <td  colSpan={8}>0</td>
  </tr>
</tbody>
</table>

При этом во время чтения должна отправляться команда с CE_ROM равным «0». Передача прочитанных данных осуществляется в соответствии со стандартом IEEE Std 1149.1-2001.

:::info Примечание
Выход из инструкции не обнуляет пользовательский тестовый регистр данных.
:::

### IF_ACCESS

Инструкция «IF_ACCESS» («Интерфейс доступа») представляет собой дополнительную пользовательскую инструкцию c кодом 101b и пользовательским тестовым регистром данных разрядностью 19 бит.

:::info Примечание
Выход из инструкции не обнуляет пользовательский тестовый регистр данных.
:::

### DEBUGGER

Инструкция «DEBUGGER» («Отладчик») представляет собой дополнительную пользовательскую инструкцию c кодом 110b и пользовательским тестовым регистром данных разрядностью 5 бит.

:::info Примечание
Выход из инструкции не обнуляет пользовательский тестовый регистр данных.
:::
