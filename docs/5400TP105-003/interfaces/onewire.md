---
id: mk-owi
title: 1-Wire
sidebar_label: 1-Wire
sidebar_position: 5
---

1-Wire или OWI – это интерфейс, который представляет собой двунаправленную шину связи для устройств с низкоскоростной передачей данных, в которой данные передаются по цепи питания. Используется всего два провода, один общий, а второй для питания и данных.

## Основные характеристики

- работа в режиме «ведущего»;
- минимальная частота тактирования 1 МГц;
- поддержка стандартной и повышенной скоростей обмена;
- поддержка набора стандартных команд;
- расширенный набор статусов и прерываний.

## Структурная схема 

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/onewire/OWI_структурная_схема.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Структурная схема 1-Wire</figcaption>
</figure>
</div>

OWI состоит из следующих блоков:

- REGISTERS – блок для хранения управляющих данных и статусов;
- BUFFER_TX – буфер передатчика;
- SHIFT_TX – сдвиговый регистр передатчика;
- BUFFER_RX – буфер приемника;
- SHIFT_RX – сдвиговый регистр приемника;
- CLOCK_DIVIDER – делитель частоты;
- 1-WIRE_TIMING_AND_CONTROL – основной блок интерфейса, содержащий управляющие автоматы и отвечающий за корректное функционирование.

## Сигналы шины 1-Wire

Модуль OWI поддерживает следующие формы сигналов: цикл сброса/обнаружения присутствия, тайм-слот записи нуля, тайм-слот записи единицы и тайм-слот чтения.

Цикл сброса/обнаружения присутствия состоит из двух этапов: в течение времени *t_RSTL* ведущий подтягивает линию к низкому уровню, далее начинается окно _t_RSTH_, в течение которого после задержки *t_PDH* ведомое устройство переводит линию к низкому уровню на промежуток времени _t_PDL_, чтобы сообщить о своем присутствии. Для проверки импульса присутствия модуль OWI сначала ожидает _t_PDW_, а затем в течение *t_PDSW* производит выборку напряжения вывода 1W_IO.

Модуль OWI позволяет включить маскирование импульса присутствия, генерируемого ведомым устройством, установив бит PPM регистра OWI*CTRL. При установленном бите PPM модуль OWI генерирует импульс присутствия (пунктирная линия), который начинается с конца *t_PPMS* и длится до конца \_t_PPME*.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/onewire/OWI_сброс_присутствие.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Цикл сброса/обнаружения присутствия</figcaption>
</figure>
</div>

Тайм-слот записи нуля состоит из двух этапов: ведущий подтягивает линию в течение _t_W0L_, далее следует время восстановления _t_REC0_. Сумма времени _t_W0L_ и _t_REC0_ равна длительности тайм-слота _t_SLOT_.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/onewire/OWI_запись_0.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Тайм-слот записи нуля</figcaption>
</figure>
</div>

Тайм-слот записи единицы также состоит из двух этапов: ведущий подтягивает линию в течение _t_W1L_, затем ожидается завершение тайм-слота.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/onewire/OWI_запись_1.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Тайм-слот записи единицы</figcaption>
</figure>
</div>

Тайм-слот чтения состоит из трех этапов: ведущий подтягивает линию к низкому уровню в течение _t_W1L_, ведомый устанавливает уровень на линии, после чего ожидается завершение тайм-слота. В течение *t_MRS* модуль OWI осуществляет выборку напряжения вывода 1W*IO. Следует иметь ввиду, что ведомое устройство, отвечая нулем, начинает устанавливать низкий уровень на линии 1W_IO до того, как истечет время \_t_W1L*.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/onewire/OWI_чтение_данных.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Тайм-слот чтения</figcaption>
</figure>
</div>

<table className="table">
<tbody>
 
  <tr>
    <th >Обозначение</th>
    <th >Параметр, единица измерения</th>
    <th >Условия</th>
    <th >Мин</th>
    <th >Макс</th>
  </tr>

  <tr>
    <td >T_OWI</td>
    <td >Внутренний период<br/>синхросигнала модуля, мкс</td>
    <td >Для достижения данного периода делитель входной системной частоты настроить в соответствии с таблицей регистра <a href="#owi_prcr">OWI_PRCR</a></td>
    <td >0,8</td>
    <td >1</td>
  </tr>

  <tr>
    <td rowSpan={4} >t_SLOT</td>
    <td rowSpan={4} >Длительность тайм-слота, мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 0</td>
    <td >56</td>
    <td >70</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 1</td>
    <td >64</td>
    <td >80</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >8</td>
    <td >10</td>
  </tr>

  <tr>
    <td rowSpan={3} >t_W0L</td>
    <td rowSpan={3} >Время низкого уровня тайм-слота записи нуля (Write-zero Low time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи</td>
    <td >48</td>
    <td >60</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >6,4</td>
    <td >8,0</td>
  </tr>

  <tr>
    <td rowSpan={4} >t_W1L</td>
    <td rowSpan={4} >Время низкого уровня тайм-слота записи единицы/чтения (Write-one/read Low time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 0</td>
    <td >4,8</td>
    <td >6,0</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 1</td>
    <td >6,4</td>
    <td >8,0</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >0,8</td>
    <td >1,0</td>
  </tr>

  <tr>
    <td rowSpan={4} >t_MRS</td>
    <td rowSpan={4} >Время выборки тайм-слота чтения (Master Read Sample time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 0</td>
    <td >12</td>
    <td >15</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 1</td>
    <td >19,2</td>
    <td >24</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >1,6</td>
    <td >2,0</td>
  </tr>

  <tr>
    <td rowSpan={4} >t_REC0</td>
    <td rowSpan={4} >Время восстановления уровня тайм-слота записи нуля (Write-zero Recovery time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 0</td>
    <td >8</td>
    <td >10</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 1</td>
    <td >16</td>
    <td >20</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >1,6</td>
    <td >2,0</td>
  </tr>

  <tr>
    <td rowSpan={3} >t_RSTL</td>
    <td rowSpan={3} >Время низкого уровня цикла сброса (Reset Low time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи</td>
    <td >480</td>
    <td >600</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >56</td>
    <td >70</td>
  </tr>

  <tr>
    <td rowSpan={3} >t_RSTH</td>
    <td rowSpan={3} >Время высокого уровня цикла сброса (Reset High time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи</td>
    <td >384</td>
    <td >480</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >46,4</td>
    <td >58</td>
  </tr>

  <tr>
    <td rowSpan={3} >t_PDW</td>
    <td rowSpan={3} >Время ожидания цикла присутствия (Presence-Detect Wait time), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи</td>
    <td >8,0</td>
    <td >10</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >1,6</td>
    <td >2,0</td>
  </tr>

  <tr>
    <td rowSpan={4} >t_PDSW</td>
    <td rowSpan={4} >Время выборки цикла присутствия (Presence-Detect Sample Window), мкс</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 0</td>
    <td >48,8</td>
    <td >61</td>
  </tr>

  <tr>
    <td >Стандартная скорость передачи, LLM = 1</td>
    <td >60,8</td>
    <td >76</td>
  </tr>

  <tr>
    <td >Ускоренная передача</td>
    <td >6,4</td>
    <td >8,0</td>
  </tr>

  <tr>
    <td >T_PPMS</td>
    <td >Время начала маскированного цикла присутствия (Presence-Pulse Mask Start), мкс</td>
    <td >Стандартная скорость передачи</td>
    <td >16</td>
    <td >20</td>
  </tr>

   <tr>
    <td >T_PPME</td>
    <td >Время завершения маскированного цикла присутствия (Presence-Pulse Mask End), мкс</td>
    <td >Стандартная скорость передачи</td>
    <td >72</td>
    <td >90</td>
  </tr>

</tbody>
</table>

\* – Временные характеристики зависят от задержек на универсальных портах ввода-вывода. Если порты работают медленно, то эти характеристики изменятся соответствующим образом.

### Предварительная настройка

Перед началом работы с модулем OWI настроить предделитель и делитель частоты и включить систему тактирования в регистре OWI_PRCR. При необходимости использовать порывания задать соответствующие значение в регистр маски OWI_MSK. После этого модуль готов к работе на стандартной скорости и в байтовом режиме.

### Генерация цикла сброса/обнаружения присутствия

Для генерации цикла сброса/обнаружения присутствия записать код 01h в регистр OWI_CFG. Если включено прерывание по биту PD в регистре OWI_MSK, то микроконтроллер может продолжить работу до завершения цикла. После завершения прочитать бит PDR регистра OWI_ST, чтобы установить, был ли обнаружен импульс присутствия.

### Передача байта

Чтобы передать байт по шине 1-Wire необходимо записать его по адресу OWI_BUF в буфер передатчика. Затем данные переходят в сдвиговый регистр передатчика, где они последовательно отправляются на шину младшим битом вперед (LSB). Соответственно новый байт данных может быть записан в буфер передатчика. Как только сдвиговый регистр передатчика станет пустым, данные будут снова переданы из буфера, и процесс повторится. Каждый из этих регистров имеет флаг (регистр OWI_ST), на основе которого можно вызвать прерывание (регистр OWI_MSK). Бит TBE статусного регистра устанавливается, когда буфер передатчика пуст и готов принять новые дынные. Как только происходит запись байта в буфер передатчика, TBE очищается. Бит TEMT статусного регистра устанавливается, когда сдвиговый регистр пуст и готов принять новые данные. Как только байт передается из буфера в сдвиговый регистр, бит TEMT очищается, а TBE устанавливается.

### Прием байта

Для считывания данных с шины 1-Wire необходимо подготовить ведомое устройство (команды, ранее полученные от ведущего). Процесс приема данных аналогичен передачи. Ведущий начинает прием, записывая FFh по адресу OWI_BUF в буфер передатчика. Данные, которые затем передаются в сдвиговый регистр приемника – это побитовое «И» переданных и принятых данных. После того, как сдвиговый регистр приемника заполняется, данные передаются в буфер приемника, откуда они могут быть прочитаны по адресу OWI_BUF. Следующие байты от ведомого устройства могут быть прочитаны путем повторной записи FFh в буфер приемника. Если ведомый не был готов передать данные, то полученные данные будут идентичны переданным. На основе состояния буфера приемника и сдвигового регистра приемника также могут генерироваться прерывания. Бит RBF статусного регистра устанавливается, когда данные из сдвигового регистра переданы в буфер, а очищается после чтения буфера. Пока флаг RBF установлен, дальнейшие передачи по шине 1-Wire выполняться не должны, иначе данные могут быть потеряны, так как произойдет перезапись буфера приемника следующим принятым байтом.

## Битовый режим

Чтобы активировать битовый режим необходимо записать в бит BIT_CTL регистра OWI_CTRL «1». Последующая работа такая же, как и в байтовом режиме, однако важен только младший бит в буфере приемника/передатчика.

## Ускоренная передача

Переключение между скоростями происходит посредствам бита OD регистра OWI_CTRL. Любые операции на шине 1-Wire после обновления бита OD происходят на новой скорости. Режим длинной линии относится только к стандартной скорости.

## Режим ускоренного поиска ПЗУ (Search ROM Accelerator)

Прежде чем перейти в режим ускоренного поиска ПЗУ необходимо выполнить цикл сброса/обнаружения присутствия и отправить команду поиска ПЗУ (Search ROM – F0h) в байтовом режиме. Буфер приемника не должен содержать данных. Далее можно переходить в режим ускоренного поиска ПЗУ, переведя бит SRA регистра OWI_CFG в «1».

Для завершения одной процедуры поиска ведущий должен передать 16 байт, построенных согласно таблице 10. Каждый байт, записанный в регистр передатчика, содержит полубайт данных решений несоответствий. В конце каждой процедуры ведущий узнает идентификатор одного ведомого устройства.

<table className="table">
<tbody>

  <tr>
    <th >№ байта</th>
    <th >Буфера</th>
    <th >Бит 7</th>
    <th >Бит 6</th>
    <th >Бит 5</th>
    <th >Бит 4</th>
    <th >Бит 3</th>
    <th >Бит 2</th>
    <th >Бит 1</th>
    <th >Бит 0</th>
  </tr>

   <tr>
    <td rowSpan={2}>1</td> 
    <td >Передатчик</td>
    <td >r3</td>
    <td >x</td>
    <td >r2</td>
    <td >x</td>
    <td >r1</td>
    <td >x</td>
    <td >r0</td>
    <td >x</td>
  </tr>
  
   <tr>
    <td >Приемник</td>
    <td >ID3</td>
    <td >d3</td>
    <td >ID2</td>
    <td >d2</td>
    <td >ID1</td>
    <td >d1</td>
    <td >ID0</td>
    <td >d0</td>
  </tr>
   <tr>
    <td rowSpan={2}>2</td> 
    <td >Передатчик</td>
    <td >r3</td>
    <td >x</td>
    <td >r2</td>
    <td >x</td>
    <td >r1</td>
    <td >x</td>
    <td >r0</td>
    <td >x</td>
  </tr>
  
   <tr>
    <td >Приемник</td>
    <td >ID3</td>
    <td >d3</td>
    <td >ID2</td>
    <td >d2</td>
    <td >ID1</td>
    <td >d1</td>
    <td >ID0</td>
    <td >d0</td>
  </tr>
     <tr>
    <td colSpan={10} >...</td> 
  </tr>
  <tr>
    <td rowSpan={2}>16</td> 
    <td >Передатчик</td>
    <td >r63</td>
    <td >x</td>
    <td >r62</td>
    <td >x</td>
    <td >r61</td>
    <td >x</td>
    <td >r60</td>
    <td >x</td>
  </tr>
  
   <tr>
    <td >Приемник</td>
    <td >ID63</td>
    <td >d3</td>
    <td >ID62</td>
    <td >d2</td>
    <td >ID61</td>
    <td >d1</td>
    <td >ID60</td>
    <td >d60</td>
  </tr>
  
</tbody>
</table>

x – биты, которые не имеют значения;

r_n – биты, которые выдаст ведущий при несоответствии идентификаторов;

d_n – флаги несоответствия (равен «1», если есть несоответствие или нет ответа);

ID_n – биты фактически выбранного идентификатора.

Для каждого бита (с 0 по 63) ведущий генерирует следующие три тайм-слота:

- b1 – прием данных (истинный бит);
- b2 – прием данных (инверсный бит);
- b3 – передача данных.

В третьем временном интервале b3 ведущий передает «1» и «0» следующим образом:

- b3 = r_n, если у двух и более устройств разные значения n-ого бита;
- b3 = b1, если у всех устройств одинаковый n-ый бит;
- b3 = «1», в случае если есть ошибка (нет ответа).

Бит, переданный в тайм-слоте b3, идентичен ID_n.

Для начала выполнения поиска ПЗУ во все r_n биты пишутся нули. В случае возникновения ошибки все последующие биты ID_n будут равны «1» до тех пор, пока бит SRA не будет деактивирован. Таким образом, если биты ID_63 и d_63 равны «1», то произошла ошибка во время процедуры поиска и необходимо повторить последнюю последовательность. В противном случае, все ID_n (с 0 до 63) – это идентификатор ПЗУ устройства, которое было найдено и адресовано. После завершения поиска ПЗУ нужно очистить бит SRA для вывода ведущего из режима Search ROM Accelerator. Для поиска следующего устройства повторно используется предыдущий набор r_n (n = 0…63), но r_m устанавливается в «1», где m – наивысший порядок флага несоответствия. Все r_i, где i > m, устанавливаются в «0». Этот процесс повторяется до тех пор, пока не произойдет расхождение на одной и той же битовой позиции в течение двух проходов.

### Пример использования режима

В данном примере рассматривается процесс поиска четырех различных устройств на шине 1-Wire. Они имеют следующие идентификаторы (представлены только младшие значащие биты от 0 до 8):

ROM1 = 00110101…

ROM2 = 10101010…

ROM3 = 11110101…

ROM4 = 00010001…

1.  Микроконтроллер инициализирует импульс сброса, записывая 01h в регистр OWI_CFG. Все подчиненные устройства отвечают импульсом обнаружением присутствия.
2.  Микроконтроллер отправляет команду поиска ПЗУ (Search ROM), записывая F0h в буфер передатчика. Необходимо дождаться установления статуса RBF и считать (освободить) буфер приемника.
3.  Микроконтроллер переводит модуль в режим Search ROM Accelerator, записывая 02h в регистр OWI_CFG.
4.  Микроконтроллер записывает 00h в буфер передатчика и считывает возвращаемые данные из буфера приемника. Этот процесс повторяется для всех 16 байт. Считанные данные будут содержать в ID*n ROM4, а «1» установлена в d_0 (r_n содержит «0», следовательно, ROM2 и ROM3 переходят в состояние ожидания) и d_2 (аналогично первому случаю ROM1 переходит в состояние ожидания). Принятые данные выглядят следующим образом (ID_n подчеркнуты, наиболее значащий флаг несоответствия **выделен**): полученные данные (1) = 1\*0_0_0**\*1**\_0_0_1_0_0_0_0_0_0_0_1*…
5.  Микроконтроллер преобразует полученные данные в идентификатор устройства путем устранения лишних битов.
6.  Микроконтроллер записывает 00h в регистр OWI_CFG для выхода из режима ускоренного поиска ПЗУ. После этого ведущий может продолжить работу с адресованным ведомым.
7.  Для нахождения следующего устройства шаги с 1-ого по 6-ой повторяются, только на этот раз в передаваемой последовательности наиболее значащий бит решения несоответствия (r*2 в данном случае) инвертируется, и все данные, следующие за ним, устанавливаются в ноль. Полученные данные содержат идентификатор ROM1, а d_0 и d_2 снова установлены в «1»:  
    отправленные данные (2) = 0*0_0_0_0_1_0_0_0_0_0_0_0_0_0_0*…  
    полученные данные (2) = 1\*0_0_0**\*1**\_1_0_1_0_0_0_1_0_0_0_1*…
8.  Так как наиболее значащий флаг несоответствия остался прежним (d*2), то нужно использовать следующий наиболее значащий (d_0). Процесс повторяется. Следующие итерации выглядят следующим образом:   
    отправленные данные (3) = 0*1*0_0_0_0_0_0_0_0_0_0_0_0_0_0*…  
    полученные данные (3) = 1\*1**\*1**\_0_0_1_0_0_0_1_0_0_0_1_0_0*…  
    отправленные данные (4) = 0*1_0_1_0_0_0_0_0_0_0_0_0_0_0_0*…  
    полученные данные (4) = 1\*1**\*1**\_1_0_1_0_1_0_0_0_1_0_0_0_1*…
9.  Так как наиболее значащий флаг несоответствия (d_2) не изменился, то переходим к следующему (d_0). Однако, d_0 обработан дважды, а менее значимых флагов несоответствия больше нет. Следовательно поиск завершен, найдены идентификаторы всех четырех устройств.

## Статусы и прерывания

В отличии от остальных модулей в OWI прерывание по биту-событию не формируется от последующих событий после перехода бита в «1», пока он не будет сброшен чтением обратно в «0». Остальные принципы работы, описанные в разделе «Типы статусов и прерывания», остаются неизменными.

## Регистры 1-Wire

| №     | Аббревиатура | Доступ | Описание                             |
| ----- | ------------ | ------ | ------------------------------------ |
| 2B00h | OWI_CFG      | RW\*   | Регистр конфигурации                 |
| 2B04h | OWI_BUF      | RW     | Регистр буфера приемника/передатчика |
| 2B08h | OWI_ST       | R      | Регистр статуса                      |
| 2B0Ch | OWI_MSK      | RW     | Регистр маски                        |
| 2B10h | OWI_PRCR     | RW     | Регистр делителя часты               |
| 2B14h | OWI_CTRL     | RW     | Регистр управления                   |

\* – Не все регистры доступны для записи.

### OWI_CFG

Данный регистр используется для генерации цикла сброса/обнаружения присутствия 1-Wire, а также для активации или деактивации режима ускоренного поиска ПЗУ (Search ROM Accelerator), который позволяет избежать использования однобитовых операции с шиной (бит FOW) во время процедуры поиска. В дополнение этим двум функциям регистр содержит 2 бита для непосредственного управления выводом 1W_IO.

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={4} >Резерв</td>
    <td  >OW_IN</td>
    <td  >FOW</td>
    <td  >SRA</td>
    <td  >1WR</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={4} >0</td>
    <td  >1W_IO</td>
    <td  colSpan={3} >0</td>
  </tr>
  
</tbody>
</table>

**OW_IN (1-Wire Input)** – текущее значение на линии 1-Wire (только чтение):

- 1 – значение на линии соответствует логической единице;
- 0 – значение на линии соответствует логическому нулю.

Используется в сочетании с битом FOW для выполнения пользовательских функций. Например,   
для чтения необходимо изменить FOW на «0», затем подождать необходимое количество времени и установить состояние OW_IN.

**FOW (Force 1-Wire)** – прямое управление линией 1-Wire:

- 1 – переводит линию в состояние логического нуля;
- 0 – оставляет линию в состоянии высокого импеданса.

Данную функцию необходимо разрешить путем записи бита EN_FOW регистра OWI_CTRL.   
В противном случае изменение FOW не влияет на состояние шины. Если EN_FOW и FOW равны «1», то генерация импульса сброса и функция передачи/приема (регистр OWI_BUF) не работают. Изменение EN_FOW на «0» имеет тот же эффект, что и запись в FOW «0».

**SRA (Search ROM Accelerator)** – включение режима ускоренного поиска ПЗУ:

- 1 – модуль работает в режиме ускоренного поиска ПЗУ;
- 0 – модуль работает в нормальном режиме.

**1WR (1-Wire Reset)** – управление генерацией последовательности сброса/обнаружения присутствия на линии 1-Wire:

- 1 – инициализировать генерацию цикла сброса/обнаружения присутствия;
- 0 – цикл сброса/обнаружения присутствия не генерируется.

Бит переводится в «0» после завершения генерации цикла сброса/обнаружения присутствия. Цикл можно прервать, записав «0».

### OWI_BUF

Все передаваемые и принимаемые данные проходят соответственно через буфер передатчика и приемника. Запись по данному адресу подключает к шине данных буфер передатчика, а считывание подключает к шине данных буфер приемника.

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  colSpan={8} >DATA</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={8} >0</td>
  </tr>
</tbody>
</table>

**DATA** – данные на передачу или принятые дынные. Данные могут передаваться в байтовом или битовом режиме в зависимости от бита BIT_CTL регистра OWI_CTRL. В битовом режиме имеет значение только младший бит.

### OWI_ST

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  >OW_LOW</td>
    <td  >OW_SHORT</td>
    <td  >RSRF</td>
    <td  >RBF</td>
    <td  >TEMT</td>
    <td  >TBE</td>
    <td  >PDR</td>
    <td  >PD</td>

  </tr>

  <tr>
    <th >Тип статуса</th>
    <td  >EVENT</td>
    <td  >EVENT</td>
    <td  colSpan={5} >FLAG</td>
    <td  >EVENT</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={4} >0</td>
    <td  >1</td>
    <td  >1</td>
    <td  >1</td>
    <td  >0</td>
  </tr>
  
</tbody>
</table>

**OW_LOW** – принят импульс присутствия от ведомого устройства. Ведомое устройство при подключении к незанятой шине генерирует спонтанный импульс присутствия, который устанавливает этот бит. Любой переход в «0» на незанятой шине также устанавливает этот бит.

**OW_SHORT** – короткое замыкание на шине. Перед началом импульса сброса или тайм-слота ведущий проверяет, находится ли шина в режиме ожидания на высоком уровне. Если в этот момент уровень шины низкий, то связь невозможна.

**RSRF (Receive Shift Register Full)** – сдвиговый регистр приемника заполнен. Когда этот бит равен «0», то это указывает на то, что сдвиговый регистр приемника не содержит данных или осуществляет их прием. После передачи данных в буфер приемника этот бит сбрасывается аппаратно.

**RBF (Receive Buffer Full)** – буфер приемника заполнен. Флаг переходит в «1», когда есть новые данные, полученные из сдвигового регистра приемника. Если бит равен «0», то это указывает, что буфер приемника не содержит новых данных. Этот бит сбрасывается аппаратно после чтения буфера приемника.

**TEMT (Transmit Shift Register Empty)** – сдвиговый регистр передатчика пуст и готов принять новые данные. Флаг устанавливается в «1», когда регистр сдвига передатчика не содержит данных. После передачи данных из буфера передатчика в сдвиговый регистр передатчика этот бит переходит в «0». Если бит равен «0», то это указывает на то, что регистр сдвига передатчика занят передачей данных.

**TBE (Transmit Buffer Empty)** – буфер передатчика пуст и готов принять новые данные. Флаг устанавливается в «1», когда буфер передатчика не содержит данных. После записи данных в буфер передатчика этот бит переходит в «0». Если бит равен «0», то это указывает на то, что буфер передатчика ждет окончания сдвига данных из сдвигового регистра передатчика.

**PDR (Presence Detect Result)** – результат цикла обнаружения присутствия:

- 1 – импульс присутствия не обнаружен;
- 0 – обнаружен импульс присутствия.

**PD (Presence Detect)** – цикл сброса/обнаружения присутствия завершен, а результат находится   
в бите PDR. При использовании прерывания по данному биту оно должно быть включено в OWI_MSK до инициализации цикла сброса.

### OWI_MSK

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  >OW_LOW</td>
    <td  >OW_SHORT</td>
    <td  >RSRF</td>
    <td  >RBF</td>
    <td  >TEMT</td>
    <td  >TBE</td>
    <td  >Резерв</td>
    <td  >PD</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={8} >0</td>
  </tr>

  </tbody>
</table>

Для каждого из битов справедливо:

- 1 – данное прерывание формируется;
- 0 – данное прерывание не формируется.

### OWI_PRCR

Модуль OWI требует внутренней тактовой частоты 1 МГц. Эта частота генерируется от тактовой частоты системы _f_clk_. Регистр OWI_PRCR позволяет управлять делителем и передделителем тактовой частоты с целью максимально приблизить *f_clk* к 1 МГц. Систему тактирования модуля необходимо настроить и включить до начала передачи по шине 1-Wire.

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  >CLK_EN</td>
    <td  colSpan={2} >Резерв</td>
    <td  colSpan={3} >DIV</td>
    <td  colSpan={2} >PRE</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={8} >0</td>
  </tr>
  
</tbody>
</table>

**CLK_EN** – включение системы тактирования OWI:

- 1 – система тактирования включена;
- 0 – система тактирования выключена.

**DIV** – выбор коэффициента делителя частоты:

- 111b – _f_clk_/128;
- 110b – _f_clk_/64;
- 101b – _f_clk_/32;
- 100b – _f_clk_/16;
- 011b – _f_clk_/8;
- 010b – _f_clk_/4;
- 001b – _f_clk_/2;
- 000b – _f_clk_.

**PRE** – выбор коэффициента предделителя частоты:

- 11b – _f_clk_/7;
- 10b – _f_clk_/5;
- 01b – _f_clk_/3;
- 00b – _f_clk_.

Делитель и предделитель работают совместно.

<table className="table">
<tbody>

<tr>
 <th rowSpan={2} >Мин. fclk, МГц</th>
    <th rowSpan={2}>Макс. fclk, МГц</th>
    <th rowSpan={2}>Макс. погрешность fclk, %</th>
    <th rowSpan={2}>Коэф. деления</th>
    <th colSpan={3}>DIV</th>
    <th colSpan={2}>PRE</th>
</tr>

  <tr>
    <td >2</td>
    <td  >1</td>
    <td  >0</td>
    <td  >1</td>
    <td  >0</td>
  </tr>
  
<tr>
    <td  >1</td>
    <td  >1,25</td>
    <td  >25</td>
    <td  >1</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
  </tr>
  
<tr>
    <td  >2</td>
    <td  >2,5</td>
    <td  >25</td>
    <td  >2</td>
    <td  >0</td>
    <td  >0</td>
    <td  >1</td>
    <td  >0</td>
    <td  >0</td>
  </tr>

  <tr>
    <td  >3</td>
    <td  >3,75</td>
    <td  >25</td>
    <td  >3</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >1</td>
  </tr>
  
  <tr>
    <td  >4</td>
    <td  >больше 5 </td>
    <td  >25</td>
    <td  >4</td>
    <td  >0</td>
    <td  >1</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
  </tr>

  <tr>
    <td  >5</td>
    <td  >больше 6 </td>
    <td  >20</td>
    <td  >5</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >1</td>
    <td  >0</td>
  </tr>

  <tr>
    <td  >6</td>
    <td  >больше 7 </td>
    <td  >17</td>
    <td  >6</td>
    <td  >0</td>
    <td  >0</td>
    <td  >1</td>
    <td  >0</td>
    <td  >1</td>
  </tr>

  <tr>
    <td  >7</td>
    <td  >больше 8 </td>
    <td  >14</td>
    <td  >7</td>
    <td  >0</td>
    <td  >0</td>
    <td  >0</td>
    <td  >1</td>
    <td  >1</td>
  </tr>

  <tr>
    <td  >8</td>
    <td  >больше 10 </td>
    <td  >25</td>
    <td  >8</td>
    <td  >0</td>
    <td  >1</td>
    <td  >1</td>
    <td  >0</td>
    <td  >0</td>
  </tr>
 
</tbody>
</table>

### OWI_CTRL

<table className="table">
<tbody>

  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

   <tr>
    <th >Назначение</th>
    <td  >Резерв</td>
    <td  >OD</td>
    <td  >BIT_CTL</td>
    <td  colSpan={2} >Резерв*</td>
    <td  >EN_FOW</td>
    <td  >PPM</td>
    <td  >LLM</td>
  </tr>

   <tr>
    <th >Начальное значение</th>
    <td  colSpan={8} >0</td>
  </tr>
  
</tbody>
</table>

\* – Не изменять начальное значение.

**OD (Overdrive)** – режимом ускоренной передачи:

- 1 – режим ускоренной передачи включен;
- 0 – режим ускоренной передачи выключен.

**BIT_CTL** – выбор битового или байтового режима:

- 1 – режим битовой передачи включен;
- 0 – режим байтовой передачи выключен.

Следовательно, в битовом режиме соответствующие биты в статусном регистре устанавливаются после 1 тайм-слота, а не после 8 тайм-слотов, как в байтовом режиме.

**EN_FOW (Enable Force 1-Wire)** – разрешение прямого управления линией 1-Wire:

- 1 – разрешено управление линией 1-Wire посредствам бита FOW регистра OWI_CFG;
- 0 – прямое управление линией 1-Wire запрещено.

**PPM (Presence Pulse Masking)** – режим маскирования импульса присутствия:

- 1 – маскирование импульса присутствия включено;
- 0 – маскирование импульса присутствия выключено.

В условиях длинной линии импульсы присутствия, генерируемые ведомыми устройствами, могут вызывать помехи на линии. Маскирование импульса присутствия может предотвратить неблагоприятные эффекты, вызванные импульсом присутствия. Если PPM равен «1», то результат цикла обнаружения присутствия (бит PDR регистра OWI_ST) всегда равен «0», даже если на шине нет ведомого устройства.

**LLM (Long Line Mode)** – режим длинной линии:

- 1 – режим длинной линии включен;
- 0 – режим длинной линии выключен.

Включение режима длинной линии изменяет стандартные временные характеристики, чтобы они лучше подходили для связи по длинной линии.
