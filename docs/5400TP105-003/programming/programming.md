---
id: mk-prog
title: Программирование
sidebar_label: Программирование
sidebar_position: 2
---

Программирование микроконтроллера в SOFT и HARD режимы.

## Подготовка к работе с отладочным комплектом

1. Подключить блок питания к плате
2. Соединить плату с ПК с помощью USB-кабеля

Зайти в диспетчер устройств

Для Windows 10 – нажмите по иконке поиска в панели задач и наберите «диспетчер устройств» в поле ввода, а после того, как нужный элемент будет найден, нажмите по нему ЛКМ для открытия.

Для Windows 7 и 8 – откройте пуск и введите в поле поиска фразу «диспетчер устройств», а после того, как нужный элемент будет найден, нажмите по нему ЛКМ для открытия.

Во вкладке «Порты (COM и LPT)» можно посмотреть какой СОМ-порт соответствует отладочной плате. В примере плата подключена к порту COM3.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/7.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Диспетчер устройств</figcaption>
</figure>
</div>

Если компьютер не распознает отладочную плату, то следует установить драйвер СP210x: загрузить архив CP210x_Windows_Drivers с сайта компании [https://dcsoyuz.ru](https://dcsoyuz.ru) в разделе «Программное обеспечение», либо с сайта разработчика [ttps://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers](ttps://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers).

## Режимы работы микросхемы

Микросхема 5400ТР105-003 имеет два режима работы:

- режим отладки с возможностью многократного перепрограммирования (режим «SOFT»);
- режим финальной конфигурации с записью в энергонезависимую память (режим «HARD»).

## Программирование микросхемы в режим «SOFT»

1. Вставьте микросхему в контактирующее устройство на отладочной плате. Направление первого вывода микросхемы указано шелкографией с цифрой «1» над контактирующим устройством. Прижмите микросхему крышкой контактирующего устройства.
2. Нажать кнопку включения питания на плате (<a href='/docs/5400TP105-003/programming/mk-develop-kit#описание-элементов-отладочной-платы'>Рисунок, элемент №18</a>);
3. В случае использования внешнего генератора. Перевести переключатель (<a href='/docs/5400TP105-003/programming/mk-develop-kit#описание-элементов-отладочной-платы'>Рисунок, элемент №9</a>)
   в положение «GEN». Подать прямоугольный сигнал (меандр) от 0 В до 5,0 В с частотой 4 МГц (допустимый диапазон частоты от 500 кГц до 8 МГц) на вывод (<a href='/docs/5400TP105-003/programming/mk-develop-kit#описание-элементов-отладочной-платы'>Рисунок, элемент №8</a>).
   В случае использования кварцевого резонатора необходимо перевести переключатель (<a href='/docs/5400TP105-003/programming/mk-develop-kit#описание-элементов-отладочной-платы'>Рисунок, элемент №9</a>) в положение «RES».

4. Запустить приложение DCSProg6.exe из папки DCSProg6;

При подключении платы и включении питания происходит автоматическая идентификация платы в правом нижнем углу программы. Если идентификация не прошла, то приложение опрашивает COM-порт каждые 3 секунды. Без идентификации программирование микросхемы невозможно.

:::info Примечание
Если требуется программирование микросхемы в составе вашего устройства (без отладочной платы КФЦС.441461.196) с помощью программатора, то для завершения идентификации необходимо нажать сочетание клавиш `Ctrl+F12` и в окне выбрать микросхему `«5400ТР105-003»`. После этого идентификация будет пройдена и программирование станет доступно.
:::

:::caution Важно!
Если идентификация не проходит, сообщите о проблеме в службу технической поддержки по электронной почте support@dcsoyuz.ru. Проведение идентификации с помощью диалогового окна (сочетание клавиш Ctrl+F12) в составе отладочного комплекта не является штатным режимом работы.
:::

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/8.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Завершение идентификации через диалоговое меню</figcaption>
</figure>
</div>

Если подключено больше одного COM-порта к компьютеру, то программа выведет диалоговое окно с выбором СОМ-порта. В диалоговом окне выберите СОМ-порт,
который соответствует плате, и нажмите «ОК».

Методика определения СОМ-порта приведена в пункте в пункте «Подготовка к работе с отладочным комплектом». После автоматической идентификации в правом нижнем углу программы появится надпись «5400ТР105-003».

5. После идентификации загрузите файл с конфигурацией:
   `«Микросхема» –> «Загрузить hex файл»`, выбрать ранее скомпилированный hex-файл и нажать кнопку «Открыть» (расположение файла: `«…\Projects\Example\Objects»`);

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/9.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Расположение hex-файла</figcaption>
</figure>
</div>

Выбранный hex-файл отобразится в программе DCSProg6:

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/10.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Окно программы после загрузки hex-файла</figcaption>
</figure>
</div>

7. Для программирования микросхемы в режиме отладки (режим «SOFT») выполнить: <br/>
   `«Микросхема» –> «Прошить ОЗУ»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/11.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Программирование микросхемы в режиме «SOFT»</figcaption>
</figure>
</div>

В случае успешного программирования в окне программы будет выведено `«Микросхема запрограммирована в режиме SOFT»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/12.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Сообщение о успешном программировании в режиме «SOFT»</figcaption>
</figure>
</div>

В случае ошибок при программировании в окне программы будет указан первый адрес, в котором возникла ошибка записи.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/13.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Ошибка при программировании в режиме «SOFT»</figcaption>
</figure>
</div>

8. Микросхема запрограммирована и работает в режиме отладки (режим «SOFT»).
9. Для перепрограммирования микросхемы в режиме «SOFT» (отладка микросхемы) повторить методику с пункта 6.

В случае успешного программирования микросхемы на отладочной плате будут мигать светодиоды VD1-VD4.

Временная диаграмма представлена на рисунке ниже.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/dia.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Временная диаграмма работы проекта Example.uvproj (t1 – ~60 мс)</figcaption>
</figure>
</div>

## Программирование микросхемы в режим режим «HARD»

1. Запрограммировать микросхему в режим «SOFT».
2. Выполнить `«Микросхема» –> «Прожечь ПЗУ»`. В открывшемся окне подтвердить программирование микросхемы – кнопка «Yes»;

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/14.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Программирование микросхемы в режим «HARD»</figcaption>
</figure>
</div>

:::caution Важно!
Прожиг объемной программы занимает длительное время. В момент прожига взаимодействие с программой DCSProg6.exe запрещено.
:::

После завершения программирования микросхемы программа выдаст сообщение `«Микросхема запрограммирована в ПЗУ»`. По завершению программирования произойдет автоматический программный сброс микроконтроллера по JTAG.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/15.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Окно окончания программирования</figcaption>
</figure>
</div>

В случае ошибок при программировании в окне программы будет указан первый адрес, в котором возникла ошибка записи.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/16.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Ошибка записи в ПЗУ</figcaption>
</figure>
</div>

После программирования в режиме «HARD» в качестве проверки верной записи данных можно считать их из однократно программируемого ПЗУ. Для этого необходимо выполнить `«Микросхема» –> «Считать ПЗУ микросхемы»`. Считанные данные запишутся в файл Read_ROM_time.txt.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/17.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Считывание ПЗУ</figcaption>
</figure>
</div>

## Программирование конфигурационной памяти в режим режим «SOFT»

В микросхеме реализована конфигурационная память, которая может работать как в «SOFT», так и в «HARD» режиме. Более подробно о регистрах конфигурационной памяти в разделе <a href='/docs/5400TP105-003/mk-analog-cfg'>«Конфигурационная память»</a>. Регистры модуля <a href="/docs/5400TP105-003/mk-analog-cfg#регистры-модуля-analog_cfg">ANALOG_CFG</a> подключены к конфигурационному однократно программируемому ПЗУ.

1. Открыть проект «analog_cfg_ex.uvproj». Путь к файлу проекта в архиве Projects.zip `…/Projects/ANALOG_CFG/ analog_cfg_ex.uvproj`;

Данный проект настраивает частоту RC-генератора на выводе GPIOB_1.

2. Для настройки конфигурационной памяти необходимо выставить нужные биты в проекте analog_cfg_ex.uvproj в регистрах ANALOG_CFG согласно <a href="/docs/5400TP105-003/mk-analog-cfg#регистры-модуля-analog_cfg">таблице</a>.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/18.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Пример настройки конфигурационной памяти</figcaption>
</figure>
</div>

3. Выполнить `«Микросхема» –> «Загрузить файл»`, выбрать скомпилированный hex-файл и нажать кнопку «Открыть»;

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/19.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Окно программы после выбора hex-файла</figcaption>
</figure>
</div>

4. Выполнить `«Конфигурационная память» –> «Прошить конфигурационную память»` для программирования в режиме отладки (режим «SOFT»);

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/20.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Прошивка конфигурационной памяти («SOFT»)</figcaption>
</figure>
</div>

5. После завершения программирования программа выдаст сообщение `«Конфигурационная память настроена в режиме «SOFT»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/21.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Завершение настройки конфигурационной памяти</figcaption>
</figure>
</div>

Результат программирования конфигурационной памяти можно проверить на выводе GPIOB&lt;1&gt; – частота RC-генератора.

## Программирование конфигурационной памяти в режим «HARD»

1. Настроить конфигурационную память в режиме «SOFT»;
2. Выполнить `«Конфигурационная память – Прожечь конфигурационную память»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/22.png" alt="" />
  <figcaption className="doc-image-container__image-title">Прожиг конфигурационной памяти («HARD»)</figcaption>
</figure>
</div>

Конфигурационная память запрограммирована и работает в режиме финальной конфигурации (режим «HARD»). Результат программирования можно проверить на выводе GPIOB_1 – частота внутреннего RC-генератора.

## Программный сброс

Помимо аппаратного сброса (<a href='/docs/5400TP105-003/programming/mk-develop-kit#описание-элементов-отладочной-платы'>Рисунок, элемент №14</a>) на отладочной плате в DCSProg6 реализован программный сброс. Для сброса необходимо выполнить `«Микросхема» –> «Программный сброс»`, при этом программа начнет выполняться заново.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/23.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Программный сброс</figcaption>
</figure>
</div>

## Настройка напряжения питания универсальных портов ввода-вывода

В ПО есть возможность настройки напряжения на выводе VDD_DR (Положительное напряжение питания универсальных портов ввода-вывода микроконтроллера). По умолчанию на выводе VDD_DR установлено напряжение 5,0 В.

В пункте меню «VDD_DR» из выпадающего списка выберите требуемое напряжение.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/24.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Выбор напряжения на выводе VDD_DR</figcaption>
</figure>
</div>

После выбора напряжения программа выдаст информационное сообщение.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/25.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Результат успешного переключения напряжения на выводе VDD_DR</figcaption>
</figure>
</div>

При отключении питания и повторном включении, напряжение на выводе VDD_DR установится по умолчанию (5,0 В).

## Обновление программного обеспечения

Для обновления ПО программатора необходимо:

1. Скачать новый архив DCSProg6.zip с сайта компании [https://dcsoyuz.ru](https://dcsoyuz.ru) (раздел «Программное обеспечение») и извлечь данные на персональный компьютер.
2. Открыть программу DCSProg6.exe из скачанного архива и выполнить `«Помощь» –> «Обновить ПО»`.

Программатор обновляет свою прошивку с помощью файла STM32_DCSProg5v3.hex из корневой директории архива.

<div className="doc-image-container">
<figure>
  <img src="/img/5400TP105-003/programming/26.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Меню обновления DCSProg6</figcaption>
</figure>
</div>

3. Перезапустить приложение DCSProg6.exe.
