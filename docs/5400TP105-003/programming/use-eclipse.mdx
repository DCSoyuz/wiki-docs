---
id: mk-eclipse
title: Eclipse IDE
sidebar_label: Eclipse IDE
sidebar_position: 4
---

Установка и использование Eclipse IDE

## Установка и настройка Eclipse IDE

Программа для отладки разработана в виде набора плагинов для Eclipse. На текущий момент получить плагины можно только в составе сборки DCS-Eclipse.

В качестве компилятора для 5400TP105-003 предлагается использовать SDCC ([SDCC manual](https://sdcc.sourceforge.net/doc/sdccman.pdf)).

Среда разработана и протестирована на операционной системе «Ubuntu 22.04». Поддержка других операционных систем будет добавлена позднее.

### Настройка окружения

Предварительно требуется установить SDCC:

**Ubuntu 22.04**

- Загрузить архив eclipse_ubuntu с сайта в разделе «Программное обеспечение» и извлечь данные на персональный компьютер

- Установить java-17 командой

```bash
sudo apt install openjdk-17-jdk
```

- Установить компилятор для 8051 командой

```bash
sudo apt install sdcc
```

- Перейти в папку eclipse и из терминала запустить IDE командой

```bash
sudo ./eclipse
```

**Windows**

- Установить eclipse из архива eclipse_win32.
- Установить java-17 с сайта разработчика.<br/>
  https://download.oracle.com/java/17/archive/jdk-17.0.9_windows-x64_bin.msi или <br/>
  https://download.oracle.com/java/17/archive/jdk-17.0.9_windows-x64_bin.exe

- Установить SDCC. Скачать файл sdcc-winX, где X – разрядность операционной системы.
  https://sourceforge.net/projects/sdcc/files/
- Перейти в папку Eclipse и запустить eclipse.exe.

:::info Примечание
В случае, если на компьютере были установлены другие версии Java и у вас не запускается программа ниже представлены возможные пути решения проблемы.

1. Папка, в которую установлена Java-17 находится в системных переменных среды операционной системы. Путь к файлу java.exe должен находится в переменной Path. Для того, чтобы в этом убедиться нажмите ПКМ на `«Пуск»`, выберите `«Система» – «Дополнительные параметры системы»–«Переменные среды»`, выбрать переменную Path и нажать `«Изменить»`.
   Если в переменной Path находится одновременно несколько путей до java.exe, то рекомендуется удалить т.к может быть использована некорректная версия java для запуска программы.
2. Системная переменная JAVA_HOME должна ссылаться на папку с установленной java (например `C:\Program Files\Java\jdk-17\bin\` или `C:\Program Files\Common Files\Oracle\Java\javapath`). Если переменная отсутствует, то ее необходимо создать.

Если программа после всех действий не запускается и ваш путь к java содержит `C:\Program Files\Common Files\Oracle\Java\javapath`, то замените на явный путь к java `C:\Program Files\Java\jdk-17\bin\`

:::

### Создание проекта

Одновременно допускается использовать только один проект. Если требуется использовать другой проект, остальные необходимо закрыть.

Для создания первого проекта необходимо нажать на строку `Create a new C or C++ project` или `Create new Project... → C Project`

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/1.png" caption="Создание проектав в eclipse" />

В качестве категории проекта выбрать `C Project`. Нажать `Next`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/2.png" caption="Выбор категории проекта в eclipse" />

Выбрать тип проекта `Executable/5400TP105-003 C Project`.

В окне `Toolchains` выбрать `SDCC Tool Chain`, если вариантов более одного, и он не выбран по умолчанию.

Указать название проекта.

Убедиться, что проект создается в ожидаемой директории. При необходимости убрать галочку `Use default location` и изменить путь.

Нажать «Next».

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/3.png" caption="Выбор типа проекта в eclipse" />

При необходимости изменить свойства проекта.

Желательно не трогать поля `Source` и `Linker other options`.

Нажать `Next`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/4.png" caption="Свойства проекта в eclipse" />

В следующем окне ничего не изменять. Нажать кнопку `Finish`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/5.png" caption="Выбор конфигурации проекта в eclipse" />

Возможно, IDE предложит сменить перспективу. Необходимо согласиться нажатием кнопки `Open Perspective`.

Перспективу также можно сменить в правом верхнем углу рабочего окна (кнопка «Open Perspective»).

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/6.png" caption="Открытие перспективы в eclipse" />

### Настройка проекта

Для первой сборки проекта нужно выполнить ряд действий:

- Настроить проект для использования компилятора. Для этого нужно нажать ПКМ на проект и выбрать `Properties` в появившемся контекстном меню.

- В категории `С/C++ Build` нажать кнопку `Manage Configurations`, выбрать `Release` и нажать `Set Active`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/7.png" caption="Окно настроек проекта" />

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/8.png" caption="Меню управления конфигурацией" />

- В `Configuration` выбрать `Release [ Active ]`

- В категории `С/C++ Build` выбрать `Builder type: Internal builder`

- Добавить генерацию hex-файла.Перейти в подкатегорию `Settings`, в окне `Build Artifact` выбрать `Artifact extension: hex`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/9.png" caption="Установка генерации hex-файла" />

- Подтвердить изменения нажав `Apply and Close`.

- Выполнить сборку проекта нажав на молоток на панели инструментов или кнопку `Build all`.

:::info Примечание
Если в консоли возникает ошибка `«Error: Program "sdcc" not found in PATH»`, то необходимо убедиться, что в системной переменной Path среды операционной системы указан путь к sdcc. Для этого, нажмите ПКМ на `«Пуск»`, выберите `«Система» – «Дополнительные параметры системы»–«Системные переменные»`, выбрать переменную Path и нажать `«Изменить»`. Если путь отсутствует, то необходимо нажать кнопку «Создать» и добавить путь (пример `C:\Program Files\SDCC\bin`).
:::

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/10.png" caption="Сборка проекта" />

### Удаление/закрытие проекта

Для удаления/закрытия проекта необходимо нажать ПКМ по проекту и в выпадающем меню выбрать пункт `Delete`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/17.png" caption="Удаление/закрытие проекта" />


Для удаления нужно нажать на checkbox `Delete project contents on disk (cannot be undone)`. Для закрытия проекта галочку ставить не нужно. Подтвердить нажатием кнопки `OK`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/18.png" caption="Подтверждение удаления/закрытия" />


### Описание проекта

На рисунке ниже показано дерево проекта.

- **8051.h** — библиотека внутренних регистров ядра;
- **regs_map_C.h** — библиотека внешних регистров ядра;
- **lint.h** и **std.h** — файлы для более корректной работы системы проверки синтаксиса;
- **main.c** — функция main.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/16.png" caption="Дерево проекта" />


## Отладка Eclipse
Для отладки нужно выполнить подключение платы к usb порту устройства. Далее необходимо включить питание и подать частоту.

:::info Примечание (Ubuntu 22.04)
В некоторых случаях отладка может не работать из-за системы выделения прав на устройстве. В этом случае следует запустить Eclipse через терминал с дополнительными правами с помощью команды `sudo ./eclipse`
:::

После сборки проекта можно записать программу в микроконтроллер и начать отладку. Для этого следует нажать ПКМ на проекте и в контекстном меню выбрать: `Debug As → Debug Configurations…`

Создать новую конфигурацию путём двойного нажатия на `5400TP105-003 Debug` и нажать `Debug`.

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/11.png" caption="Окно запуска отладки" />

После нажатия кнопки «Debug» будет произведено программирование микросхемы в «SOFT» режим, и она будет переведена в режим отладки.

:::info Примечание
При возникновении ошибок следует проверить и переподключить плату.
:::

<DocumentFigure src="/img/5400TP105-003/eclipse-debug/12.png" caption="Внешний вид при отладке проекта" />

Справа можно увидеть 4 окна:

- **Variables**: информация об основных переменных и регистрах;
- **Breakpoints**: информация об установленных точках останова;
- **Expressions**: окно с возможностью слежения за выбранными переменными;
- **Disassembler**: окно дизассемблирования.

На панели инструментов есть 3 основных кнопки:

- **Resume** — запуск работы программы;
- **Suspend** — приостановка работы программы;
- **Terminate** — завершение работы программы.

:::info Примечание
При первой загрузке в память выполняется команда Reset для обнуления записанной программы и установки PC в начало.
:::

Точки останова можно добавить с помощью двойного нажатия левой кнопкой мыши в файле с программой.

:::info Примечание
Для микроконтроллера 5400ТР105-003 доступны только 4 одновременно установленных точки останова.
:::
