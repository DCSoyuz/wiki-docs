---
id: mk-cmm
title: Модуль управления источниками тактовых сигналов системы
sidebar_label: Модуль управления источниками тактовых сигналов системы
sidebar_position: 8
---

## Общая информация

Модуль управления источниками тактовых сигналов системы предназначен для переключения между источниками тактирования, изменения периода синхросигнала и для перехода в режим «SLEEP».

Микроконтроллер в процессе работы может переключатся между двумя источниками тактового сигнала:

- XTAL_CLK;
- RC_CLK.

В свою очередь, источником синхросигнала XTAL_CLK в зависимости от настроек конфигурационной памяти (модуль ANALOG_CFG) может быть как внешний кварцевый генератор, так и встроенный RC-генератор, а источником RC_CLK всегда является встроенный RC-генератор.

## Структурная схема

<DocumentFigure
  src="/img/5400TP105-003/cmm/Управление_иточниками_тактовых_сигналов.svg"
  alt="Структурная схема модуля управления источниками тактовых сигналов системы"
  caption="Структурная схема модуля управления источниками тактовых сигналов системы"
/>

Модуль управления источниками тактовых сигналов системы состоит из следующих блоков:

- REGISTERS – блок для хранения управляющих данных и статусов;
- SLEEP_CONTOL – блок управления режимом «SLEEP», предназначен для запуска режимов «Сон процессора» и «Глубокий сон»;
- CLOCK_SEL – блок выбора частоты тактирования, предназначен для выбора источника частоты тактирования системы;
- MUX – мультиплексор, предназначен для управления частотами, которые будут переданы в систему;
- CLOCK_DIVIDER – делитель частоты, предназначен для деления частоты выбранного источника тактирования.

## Выбор источника тактирования системы

При подаче питания тактирование системы осуществляется от XTAL_CLK. Пользователь может изменить источник тактирования путем записи необходимого значения в бит RC_XTAL регистра CMM_CTRL. На время операции переключения в регистре CMM_ST в активном уровне будет находится бит SWITCH. Когда операция переключения будет завершена, бит SWITCH примет значение «0», а NSWITCH «1». При большой разнице частот, процесс переключения займет порядка 12 тактов частоты, на которую происходит переключение, и 3 тактов текущей частоты.

Пользователь имеет возможность не переключаться между источниками XTAL_CLK и RC_CLK при переходе в режим «Глубокий сон», если источником XTAL_CLK уже является RC-генератор без ФАПЧ. Переход системы в режим «Глубокий сон» при тактировании от источника XTAL_CLK на какой-либо другой частоте приведет к полной остановке системы без возможности программного восстановления работоспособности.

## Деление частоты тактирования

Текущая частота тактирования системы может быть поделена. Для этого необходимо записать коэффициент в регистр CMM_DIV.

## Регистры модуля управления источниками тактовых сигналов системы

| №     | Аббревиатура | Доступ | Описание                 |
| ----- | ------------ | ------ | ------------------------ |
| 2100h | CMM_CTRL     | RW     | Регистр управления       |
| 2101h | CMM_DIV      | RW     | Регистр делителя частоты |
| 2102h | CMM_MSK      | RW     | Регистр маски            |
| 2103h | CMM_ST       | R      | Регистр статуса          |

### CMM_CTRL

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

<tr>
  <th>Назначение</th>
  <td colSpan={5}>Резерв*</td>
  <td colSpan={2}>Резерв*</td>
  <td>RC_XTAL</td>
</tr>

  <tr>
    <th >Начальное значение</th>
    <td colSpan={5} >0</td>
    <td colSpan={2} >1</td>
     <td >0</td>
  </tr>
</tbody>
</table>

\* – Не изменять начальное значение.

**RC_XTAL** – бит управления источником тактирования системы F<sub>SRC</sub>:

- 1 – тактирование от RC_CLK;
- 0 – тактирование от XTAL_CLK.

### CMM_DIV

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

<tr>
  <th>Назначение</th>
  <td colSpan={8}>COEF</td>
</tr>

  <tr>
    <th >Начальное значение</th>
    <td colSpan={8} >0</td>
  </tr>
</tbody>
</table>

**COEF** – коэффициент деления исходной частоты тактирования.

При COEF>0 частота тактирования системы рассчитывается по формуле:

$$
F_{CLK} = \frac {F_{SRC}}{2 \cdot COEF}
$$

где F<sub>SRC</sub> – исходная частота от источника XTAL_CLK или RC_CLK.

При COEF=0: $F_{CLK} = F_{SRC}$

### CMM_MSK

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

<tr>
  <th>Назначение</th>
  <td colSpan={7}>Резерв</td>
  <td>NSWITCH</td>
</tr>

  <tr>
    <th >Начальное значение</th>
    <td colSpan={8} >0</td>
  </tr>
</tbody>
</table>

**NSWITCH** – разрешить прерывание по статусу NSWITCH:

- 1 – данное прерывание формируется;
- 0 – данное прерывание не формируется.

### CMM_ST

<table className="table">
<tbody>
 
  <tr>
    <th >Бит</th>
    <th >7</th>
    <th >6</th>
    <th >5</th>
    <th >4</th>
    <th >3</th>
    <th >2</th>
    <th >1</th>
    <th >0</th>
  </tr>

<tr>
  <th>Назначение</th>
  <td rowSpan={2} colSpan={6}>
    Резерв
  </td>
  <td>SWITCH</td>
  <td>NSWITCH</td>
</tr>
<tr>
  <th>Тип статуса</th>
  <td>FLAG</td>
  <td>EVENT</td>
</tr>

  <tr>
    <th >Начальное значение</th>
    <td colSpan={6} >0</td>
    <td >0</td>
    <td >0</td>
  </tr>
</tbody>
</table>

**SWITCH** – переключение между частотой XTAL_CLK и RC_CLK:

- 1 – идет переключение на выбранную частоту;
- 0 – система работает на выбранной частоте.

**NSWITCH**– процесс переключения частоты тактирования окончен.
