---
id: pams-programming
title: Программирование микросхемы
sidebar_label: Программирование микросхемы
sidebar_position: 6
---

## Режимы работы микросхемы

Микросхема 5400ТР045А-031 имеет два режима работы:

- режим отладки с возможностью многократного перепрограммирования (режим «SOFT»);
- режим финальной конфигурации с записью в энергонезависимую память (режим «HARD»).

Переключение режимов работы микросхемы осуществляется автоматически программатором
с помощью вывода PRIN.

<table className="table">
<tbody>

  <tr>
    <th >PRIN, B</th>
    <th >Состояние</th>
  </tr>
  <tr>
    <td >3,5</td>
    <td >Чтение/запись «SOFT»</td>
  </tr>
   <tr>
    <td >10</td>
    <td >Запись «HARD»</td>
  </tr>
   <tr>
    <td >0</td>
    <td >Чтение «HARD»</td>
  </tr>
</tbody>
</table>

В ПО DCSProg-5p возможно вручную изменять напряжение на выводе PRIN. Для этого необходимо нажать `«Настройка»` и выбрать в выпадающем меню `«Установить PRIN в 3,5 В»` или `«Установить PRIN в 0 В»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Изменение напряжения на выводе PRIN.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Изменение напряжения на выводе PRIN</figcaption>
</figure>
</div>

После программирования микросхемы в «HARD» на выводе PRIN автоматически выставляется значение 0В (Чтение «HARD»). При отключении напряжения питания отладочной платы (+12В) и повторном включении на выводе PRIN выставляется напряжение 0В (светодиод на программаторе будет гореть зеленым цветом). В обоих случаях можно работать с микросхемой в режиме «HARD».

При программировании микросхемы в режиме «SOFT» напряжение 3,5 В на выводе PRIN выставляется программатором.

## Организация питания микросхемы

### Режим «SOFT»

Работа микросхемы в режиме «SOFT» возможна только с подключенным программатором. Напряжение питания +12В±5% подается на вывод <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«А»</a>. Все остальные необходимые для работы микросхемы напряжения формируются внутри программатора.

Переключатель <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«Д»</a> необходимо установить в положение «VDD FROM PROG/EXT».

:::info Примечание
При подключенном программаторе на выводы <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«М» и «Е»</a> запрещено подавать напряжение с внешних источников.
:::

Если необходимо отключить программатор после программирования, то следует сначала отключить напряжение питания +12 В±5%.

### Режим «HARD»

**C подключенным программатором**

Напряжение питания +12 В ± 5% подается на вывод <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«А»</a>. Все остальные необходимые
для работы микросхемы напряжения формируются внутри программатора.

Переключатель <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«Д»</a> необходимо установить в положение «VDD FROM PROG/EXT».

На выводе PRIN установить напряжение 0 В.

:::info Примечание
При подключенном программаторе на выводы <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«М» и «Е»</a> запрещено подавать напряжение с внешних источников.
:::

**Без программатора**

Напряжение питания 5,0B±5% подается на вывод <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«М»</a>.

Переключатель «Д» необходимо установить в положение «VDD FROM PROG/EXT».

:::info Примечание
На выводы «А» и «Е» запрещено подавать напряжение с внешних источников.
:::

## Программирование микросхемы

### Подготовка к работе

- Собрать отладочный комплект:
  - Соединить программатор с ПК с помощью USB-кабеля;
  - Соединить программатор с отладочной платой с помощью шлейфа (первый вывод шлейфа (обозначен красным цветом) подключить к первому выводу на отладочной плате согласно рисунку шелкографии).

Зайдите в диспетчер устройств:

Для Windows 10 – нажмите по иконке поиска в панели задач и наберите «диспетчер устройств» в поле ввода, а после того, как нужный элемент будет найден, нажмите по нему ЛКМ для открытия.

Для Windows 7 и 8 – откройте пуск и введите в поле поиска фразу «диспетчер устройств», а после того, как нужный элемент будет найден, нажмите по нему ЛКМ для открытия.

- Во вкладке «Порты (COM и LPT)» необходимо определить, какой СОМ-порт соответствует программатору.

В примере программатор подключен к порту COM3.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/develop-kit/Диспетчер устройств.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Диспетчер устройств</figcaption>
</figure>
</div>

Если компьютер не распознает программатор, то следует установить драйвер СP210x:
загрузить архив CP210x_Windows_Drivers.zip с сайта компании https://dcsoyuz.ru в разделе «Программное обеспечение», либо с сайта разработчика https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers.

- На отладочной плате установить переключатель «Д» в положение «VDD FROM PROG/EXT».

- Вставьте микросхему в спутник-носитель. Первый вывод микросхемы направлен в сторону с двумя пазами спутника-носителя. Прижмите микросхему крышкой спутника-носителя.

- Установите спутник-носитель вместе с микросхемой в контактирующее устройство и прижмите его крышкой.

<table className="table">
<tbody>

  <tr>
    <td >
    <img src="/img/5400ТР045А-031/programming/расположение_микросхемы.png" alt="" />
    </td>
    <td >
    <img src="/img/5400ТР045А-031/programming/расположение_спутника.png" alt="" />
    </td>
  </tr>
  <tr>
    <th>Расположение микросхемы в спутнике-носителе</th>
    <th>Расположение спутника-носителя в контактирующем устройстве</th>
  </tr>
</tbody>
</table>

- Подайте напряжение питания на плату +12В±5% на вывод <a href="/docs/5400TP045A-031/pams-develop-kit#внешний-вид-отладочной-платы">«А»</a> с ограничением по току 300 мА. Ток потребления отладочного комплекта без микросхемы ~90 мА. Светодиод на программаторе загорится зеленым цветом.

- Откройте приложение DCSProg-5p.exe.

Внешний вид программы представлен ниже. При подключении программатора и подаче напряжения питания на отладочную плату происходит автоматическая идентификация за счет микросхемы памяти 24AA02E48T. Без идентификации программирование микросхемы невозможно. Если идентификация не прошла, то приложение опрашивает COM-порт каждые 3 секунды.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/dcsprog-5p.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Внешний вид программы DCSProg-5p</figcaption>
</figure>
</div>

:::info Примечание
Если требуется программирование микросхемы в составе вашего устройства (без отладочной платы) с помощью программатора, то для завершения идентификации необходимо нажать сочетание клавиш `Ctrl+F12` и в окне выбрать микросхему `«5400ТР045А-031 (ПАМС)»`. После этого идентификация будет пройдена и программирование станет доступно.
:::

:::caution Важно!
Если программирование осуществляется при помощи отладочной платы и идентификация не проходит,
сообщите о проблеме в службу технической поддержки по электронной почте support@dcsoyuz.ru.
Проведение идентификации с помощью диалогового окна (сочетание клавиш Ctrl+F12) в составе
отладочного комплекта не является штатным режимом работы.
:::

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Завершение идентификации.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Завершение идентификации через диалоговое меню</figcaption>
</figure>
</div>

- Если подключено больше одного COM-порта к компьютеру, то программа выведет диалоговое окно с выбором требуемого СОМ-порта. В диалоговом окне выберите СОМ-порт, который соответствует программатору, и нажмите «ОК».

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Выбор СОМ-порта.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Выбор СОМ-порта в DCSProg-5p</figcaption>
</figure>
</div>

После автоматической идентификации в правом нижнем углу программы появится надпись «5400ТР045А-031 (ПАМС)».

Отладочный комплект готов к работе.

### Программирование «SOFT»

- После идентификации загрузите файл с конфигурацией:
  `«Микросхема» – «Загрузить файл»`, выберите файл `analog_config.txt` (расположение файла
  по умолчанию: `..\DCSElectric\config`) и нажмите кнопку `«Открыть»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/soft1.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Расположение файла с конфигурацией</figcaption>
</figure>
</div>

- Введенные номера ключей отобразятся в окне программы.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/soft2.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Содержание файла с конфигурацией в окне программы</figcaption>
</figure>
</div>

- Для программирования микросхемы в режиме отладки (режим «SOFT») нажмите
  `«Микросхема» – «Прошить»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/soft3.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Программирование микросхемы в режиме «SOFT»</figcaption>
</figure>
</div>

- После завершения программирования микросхемы программа выдаст сообщение
  `«Микросхема ПАМС запрограммирована в ОЗУ»`.

- Микросхема запрограммирована и работает в режиме отладки (режим «SOFT»).
  Светодиод на программаторе загорится синим цветом.

- Для перепрограммирования микросхемы в режиме «SOFT» (отладка микросхемы) повторить методику.

### Программирование «HARD»

- Запрограммировать микросхему в режим «SOFT».

- Отключить внешнюю периферию, которая использовалась для проверки микросхемы в режиме «SOFT» (соединительные провода, генераторы, осциллограф и т.д).

- Для программирования микросхемы в режим финальной конфигурации (режим «HARD») нажмите `«Микросхема» – «Прожечь»`. В открывшемся окне подтвердите программирование микросхемы – кнопка `«Yes»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/hard1.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Программирование микросхемы в режим «HARD»</figcaption>
</figure>
</div>

:::info Примечание
Во время программирования в режим «HARD» светодиод на программаторе мигает зелено-красным цветом. Взаимодействие с программой DCSProg-5р во время программирования запрещено.
:::

- После завершения программирования микросхемы программа выдаст сообщение `«Микросхема ПАМС запрограммирована в ПЗУ»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/hard2.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Окно окончания программирования</figcaption>
</figure>
</div>

- Микросхема запрограммирована и работает в режиме финальной конфигурации (режим «HARD»). Светодиод на программаторе загорится фиолетовым цветом.

## Обновление ПО программатора

Для корректной работы отладочного комплекта требуется использование актуальной версии ПО DCSProg-5p, отладочной платы и программатора. Версии составных частей отладочного комплекта прописаны в ПО DCSProg-5p в меню `«Помощь» – «Версия программы»`.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Версия_ПО.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Версии составных частей отладочного комплекта</figcaption>
</figure>
</div>

Обновление программатора требуется в случае выхода новой версии программного обеспечения или несоответствия версий или модификаций ПО.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Ошибка_несовместимости.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Пример несоответствия модификаций ПО</figcaption>
</figure>
</div>

Для обновления ПО программатора необходимо скачать архив DCSProg-5p.zip с сайта компании https://dcsoyuz.ru (раздел «Программное обеспечение») и извлечь данные на персональный компьютер.

Открыть программу DCSProg-5p.exe из скачанного архива и выполнить `«Помощь» – «Обновить ПО»`. После обновления ПО необходимо перезапустить приложение.

Программатор обновляет свою прошивку с помощью файла `firmware.hex` из корневой директории архива.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Меню_обновления.png" alt="" />
  <figcaption  className="doc-image-container__image-title">Меню обновления DCSProg-5p</figcaption>
</figure>
</div>

## Программирование без отладочного комплекта

Для записи конфигурационных данных используется последовательный интерфейс, который записывает данные в сдвиговый регистр. Программирование микросхемы осуществляется путем подачи последовательности длиной 370 бит на вывод DINPR.

Ключи, записанные в файле `analog_config.txt`, являются замкнутыми и соответствуют лог. «1», разомкнутые ключи соответствуют лог. «0». Запись конфигурационных данных начинается с ячейки 369 и заканчивается ячейкой 0. Временная диаграмма записи данных представлена на рисунке ниже.

### Программирование «SOFT»

- подать напряжение питания:
  - VDD1, VDD2, VDD3, VDDPR = 5,0 B ± 5%;
  - VSS1, VSS2, VSS3, VSSPR = 0 В.
- на вывод PRIN подать напряжение (3,5 ± 0,1) В;
- на вывод DINPR задать последовательность 370 бит с частотой CLKPR = 10 кГц.

### Программирование «HARD»

- запрограммировать микросхему в режиме «SOFT»;
- проверить работоспособность микросхемы;
- отключить внешнюю периферию, которая использовалась для проверки микросхемы (соединительные провода, генераторы, осциллограф и т.д);
- на вывод PRIN подать напряжение +10 В ± 5% длительностью 200 мс – 300 мс;
- установить на выводе PRIN напряжение 0 В.

<div className="doc-image-container">
<figure>
  <img src="/img/5400ТР045А-031/programming/Временная_диаграмма_программирования.svg" alt="" />
  <figcaption  className="doc-image-container__image-title">Временная диаграмма программирования</figcaption>
</figure>
</div>

При программировании в режим «HARD» для уменьшения тока по выводу PRIN рекомендуем использовать последовательное программирование и разбить конфигурационную последовательность на 37 частей следующим образом:

- 1-ая часть:

  - ключи 369 – 360: исходная конфигурационная последовательность;
  - ключи 359 – 0: лог. «0».

- 2-ая часть:
  - ключи 369 – 360: лог. «0».
  - ключи 359 – 350: исходная конфигурационная последовательность;
  - ключи 349 – 0: лог. «0».
    …
- 37-ая часть:
  - ключи 369 – 10: лог. «0»;
  - ключи 9 – 0: исходная конфигурационная последовательность.
